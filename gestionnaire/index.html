<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="../css/master.css" />
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
  <script src="https://code.jquery.com/jquery-3.4.1.js"

    integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous">
    </script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous">
    </script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous">
    </script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="../js/api.js"></script>
  <title>Site D.MINGO</title>
</head>

<body>
  <div class="header">


      <img src="../image/coopAgri.png" alt="logo">
      <h1>CoopAgri</h1>
      <span  id="burger" style="font-size:30px;cursor:pointer" onclick="openNav()">&#9776; open</span>
  </div>
  <div class="row">
    <div class="col">
      <a href="#"> Client</a>
      <a href="#">Commande</a>
      <a href="#">Livraison</a>
      <a href="#">Fournisseurs</a>
      <a href="#">Contact</a>
      <a href="#">Statistiques</a>
      <a href="#">Formulaires</a>

    </div>
  <div class="col-7 col">
    <div id="map"></div>
    <script>
      function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 12,
          center: { lat: 48.856613, lng: 2.352222 }
        });

        var lineSymbol = {
          path: google.maps.SymbolPath.CIRCLE,
          scale: 8,
          strokeColor: '#250'
        };

        directionsService = new google.maps.DirectionsService,
          directionsDisplay = new google.maps.DirectionsRenderer({
            map: map,
            polylineOptions: {
              strokeColor: 'red',
              strokeOpacity: 1,
              icons: [{
                icon: {
                  path: google.maps.SymbolPath.CIRCLE,
                  scale: 9,
                  strokeColor: '#375',
                  strokeOpacity: 0.8
                },
                offset: '100%'
              }]
            }
          })
        var waypts = Array();
        var checkboxArray = ['60 Avenue Montaigne', '6 Rue du Faubourg Saint-Honoré'];
        for (var i = 0; i < checkboxArray.length; i++) {
          waypts.push({
            location: checkboxArray[i],
            stopover: true
          });
        }
        geocoder = new google.maps.Geocoder();

        var route = adresse2LongLatt(geocoder, map, adresse, waypts);
        autoRefresh(map);

      }


      function adresse2LongLatt(geocoder, map, adresse, waypts) {
        geocoder.geocode({ 'address': adresse }, function (results, status) {
          if (status === 'OK') {
            map.setCenter(results[0].geometry.location);
            var marker = new google.maps.Marker({
              //rajouter l'icone qu'on recevra
              map: map,
              animation: google.maps.Animation.DROP,
              position: results[0].geometry.location
            });
            var route = calculateAndDisplayRoute(directionsService, directionsDisplay, adresse, waypts);
            return route;

          } else {
            alert('Geocode was not successful for the following reason: ' + status);
          }
        });
      }

      function moveMarker(map, marker, latlng) {
        marker.setPosition(latlng);
        map.panTo(latlng);
      }


      function calculateAndDisplayRoute(directionsService, directionsDisplay, pointA, waypts) {

        var first = new google.maps.LatLng(48.880540, 2.443880);
        var second = new google.maps.LatLng(48.856613, 2.352222);
        //var waypoints = Array();

        // for (let index = 0; index < waypts.length; index++) {
        //   waypoints.push({
        //     location: new google.maps.LatLng(waypts[index].latLng.lat(), waypts[index].latLng.lng()),
        //     stopover: true
        //   });
        // }

        directionsService.route({
          origin: pointA,
          destination: pointA,
          waypoints: waypts,
          optimizeWaypoints: true,
          travelMode: google.maps.TravelMode.DRIVING
        }, function (response, status) {
          if (status == google.maps.DirectionsStatus.OK) {
            directionsDisplay.setDirections(response);
            var route = directionsDisplay.getDirections().routes[0];
            var points = route.overview_path;
            return points;
          } else {
            window.alert('Directions request failed due to ' + status);
          }
        });
      }

      /*
      function moveToStep(yourmarker,yourroute,c) {
            if (yourroute.getNumSteps() > c) {
                yourmarker.setLatLng(yourroute.getStep(c).getLatLng());
                window.setTimeout(function(){
                    moveToStep(yourmarker,yourroute,c+1);
                },500);
            }
        }
        */


      marker = new google.maps.Marker({ map: map, icon: "http://maps.google.com/mapfiles/ms/micons/blue.png" });

      function autoRefresh(map) {
        var i, route, marker;

        // route = new google.maps.Polyline({
        // 	path: [],
        // 	geodesic : true,
        // 	strokeColor: '#FF0000',
        // 	strokeOpacity: 1.0,
        // 	strokeWeight: 2,
        // 	editable: false,
        // 	map:map
        // });

        // for (i = 0; i < pathCoords.length; i++) {
        // 	setTimeout(function (coords)
        // 	{
        // 		var latlng = new google.maps.LatLng(coords.lat, coords.lng);
        // 		route.getPath().push(latlng);
        // 		moveMarker(map, marker, latlng);
        // 	}, 200 * i, pathCoords[i]);
        // }
      }


      google.maps.event.addDomListener(window, 'load', initMap);



    </script>
  <script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyASkEyGK2Y2T7IJPozcR_g6S6Uo8AIOzic&callback=initMap">
  </script>

      <div>
        <h2>Livraison en cours</h2>
        <p>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Praesentium quam consectetur, veniam perferendis
          offici</p>
        <p>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Praesentium quam consectetur, veniam perferendis
          offici</p>
        <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#exampleModal">Contacter un
          livreur </button>
        <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#creerclient">Créer une
          livraison </button>
      </div>

  </div>




  <div class="col">
    3 of 3
  </div>
  </div>
</div>


    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
      aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <img src="../image/camion.png" alt="">
            <h5 class="modal-title" id="exampleModalLabel">Contacter un Livreur</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <form id="contact" method="post">
            <div class="modal-body">
              <p>Adresse :</p>
              <textarea name="" id="" cols="30" rows="10">
                        </textarea>
              <input type="radio" id="ordre" name="type" value="ordre">
              <label for="ordre">Ordre</label>
              <input type="radio" id="mission" name="type" value="mission">
              <label for="mission">Mission</label>
              <input type="radio" id="message" name="type" value="message">
              <label for="message">Message</label>
              <input type="radio" id="stop" name="type" value="stop">
              <label for="stop">Stop</label>
              <br>
              <label for="livreur">Livreur :</label>
              <select name="livreur" id="">
                <option value="1">Livreur 1</option>
                <option value="2">Livreur 2</option>
                <option value="3">Livreur 3</option>
                <option value="4">Livreur 4</option>
                <option value="5">Livreur 5</option>

              </select>
              <label>Adresse de Livraison</label>
              <input type="text">

            </div>
            <div class="modal-footer">
              <button id="submit" type="button">Envoyer</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="modal fade" id="creerclient" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
      aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <img src="../image/camion.png" alt="">
            <h5 class="modal-title" id="exampleModalLabel">Creer une livraison</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <form id="contact" method="post">
            <div class="modal-body">
              <p>Adresse :</p>
              <textarea name="" id="" cols="30" rows="10">
                        </textarea>
              <p>Type de livraison :</p>
              <input type="radio" id="ordre" name="type" value="ordre">
              <label for="ordre">Ordre</label>
              <input type="radio" id="mission" name="type" value="mission">
              <label for="mission">Mission</label>
              <br>
              <label for="livreur">Livreur :</label>
              <select name="livreur" id="">
                <option value="1">Livreur 1</option>
                <option value="2">Livreur 2</option>
                <option value="3">Livreur 3</option>
                <option value="4">Livreur 4</option>
                <option value="5">Livreur 5</option>

              </select>


            </div>
            <div class="modal-footer">
              <button id="submit" type="button">Ajouter</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div id="mySidenav" class="sidenav">
      <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
      <div class="message">

      </div>
      <script type="text/javascript">

          $('#pause').click(function(){
            jQuery('message').append('<p class='message'>Vous devez faire une pause !</p>');
            console.log("test");
          });
      </script>
      <div class="menu">


            <button  id="pause" type="button" class="btn btn-secondary menubtn">Pause</button>
            <button type="button" class="btn btn-secondary menubtn">Rappel</button>
            <button type="button" class="btn btn-secondary menubtn">alerte</button>
            <button type="button" class="btn btn-secondary menubtn">Envoyer</button>
            <br>
      <input type="text" name="" value="message">
      <button type="button" class="btn btn-primary">Envoyer</button>
    </div>




    </div>
  </div>



  <script>
    function openNav() {
      document.getElementById("mySidenav").style.display = "block";
    }

    function closeNav() {
      document.getElementById("mySidenav").style.display = "none";
    }
  </script>
  <script>
    $('#submit').click(function () {
      var form = $('#contact');
      var formData = form.serialize();
      $.ajax({
        type: "POST",
        url: 'http://vps.e-mingo.net/coopagri/app/index.php?c=message&a=getMessage',
        data: formData,
        success: function (data) {
          console.log("iok");
        },
        error: function (data) {
          console.log("false");
        }

      });
    });




  </script>
  <script>
    var adresse = "95 Avenue Baudin";

function initMap() {
  var map = new google.maps.Map(document.getElementById('map'), {
    zoom: 12,
    center: { lat: 48.856613, lng: 2.352222 }
  });

  var lineSymbol = {
    path: google.maps.SymbolPath.CIRCLE,
    scale: 8,
    strokeColor: '#250'
  };

  directionsService = new google.maps.DirectionsService,
  directionsDisplay = new google.maps.DirectionsRenderer({
    map: map,
    polylineOptions: {
      strokeColor: 'red',
      strokeOpacity: 1,
      icons: [{
        icon: {
          path: google.maps.SymbolPath.CIRCLE,
          scale: 9,
          strokeColor: '#375',
          strokeOpacity: 0.8
        },
        offset: '100%'
      }]
    }
  });

  var waypts = Array();
  var checkboxArray = ['60 Avenue Montaigne', '6 Rue du Faubourg Saint-Honoré'];
  for (var i = 0; i < checkboxArray.length; i++) {
    waypts.push({
      location: checkboxArray[i],
      stopover: true
    });
  }
  geocoder = new google.maps.Geocoder();

  var route = adresse2LongLatt(geocoder, map, adresse, waypts);
  autoRefresh(map);
}


function adresse2LongLatt(geocoder, map, adresse, waypts) {
  geocoder.geocode({ 'address': adresse }, function (results, status) {
    if (status === 'OK') {
      map.setCenter(results[0].geometry.location);
      var marker = new google.maps.Marker({
        //rajouter l'icone qu'on recevra
        map: map,
        animation: google.maps.Animation.DROP,
        position: results[0].geometry.location
      });
      var route = calculateAndDisplayRoute(directionsService, directionsDisplay, adresse, waypts);
      return route;
    } else {
      alert('Geocode was not successful for the following reason: ' + status);
    }
  });
}

function moveMarker(map, marker, latlng) {
  marker.setPosition(latlng);
  map.panTo(latlng);
}


function calculateAndDisplayRoute(directionsService, directionsDisplay, pointA, waypts) {

  var first = new google.maps.LatLng(48.880540, 2.443880);
  var second = new google.maps.LatLng(48.856613, 2.352222);
  //var waypoints = Array();

  // for (let index = 0; index < waypts.length; index++) {
  //   waypoints.push({
  //     location: new google.maps.LatLng(waypts[index].latLng.lat(), waypts[index].latLng.lng()),
  //     stopover: true
  //   });
  // }
  directionsService.route({
      origin: pointA,
      destination: pointA,
      waypoints: waypts,
      optimizeWaypoints: true,
      travelMode: google.maps.TravelMode.DRIVING
    }, function (response, status) {
      if (status == google.maps.DirectionsStatus.OK) {
        directionsDisplay.setDirections(response);
        var route = directionsDisplay.getDirections().routes[0];
        var points = route.overview_path;
        return points;
      } else {
        window.alert('Directions request failed due to ' + status);
      }
    });
}

/*
function moveToStep(yourmarker,yourroute,c) {
  if (yourroute.getNumSteps() > c) {
      yourmarker.setLatLng(yourroute.getStep(c).getLatLng());
      window.setTimeout(function(){
          moveToStep(yourmarker,yourroute,c+1);
      },500);
  }
}
*/


marker=new google.maps.Marker({map:map,icon:"http://maps.google.com/mapfiles/ms/micons/blue.png"});

function autoRefresh(map) {
  var i, route, marker;

  // route = new google.maps.Polyline({
  // 	path: [],
  // 	geodesic : true,
  // 	strokeColor: '#FF0000',
  // 	strokeOpacity: 1.0,
  // 	strokeWeight: 2,
  // 	editable: false,
  // 	map:map
  // });

  // for (i = 0; i < pathCoords.length; i++) {
  // 	setTimeout(function (coords)
  // 	{
  // 		var latlng = new google.maps.LatLng(coords.lat, coords.lng);
  // 		route.getPath().push(latlng);
  // 		moveMarker(map, marker, latlng);
  // 	}, 200 * i, pathCoords[i]);
  // }
}


google.maps.event.addDomListener(window, 'load', initMap);
</script>
<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyASkEyGK2Y2T7IJPozcR_g6S6Uo8AIOzic&callback=initMap">
</script>
<style>
    #map {
      height: 100%;
    }

    /* Optional: Makes the sample page fill the window. */
    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
  }
</style>

  <div id="map"></div>


</body>

</html>
