<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="../css/master.css" />
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
  <script src="https://code.jquery.com/jquery-3.4.1.js"

    integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous">
    </script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous">
    </script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous">
    </script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="../js/api.js"></script>
  <title>Site D.MINGO</title>
</head>

<body>
  <div class="header">


      <img src="../image/coopAgri.png" alt="logo">
      <h1>CoopAgri</h1>
      <span  id="burger" style="font-size:30px;cursor:pointer" onclick="openNav()">&#9776; open</span>
  </div>
  <div class="row">
    <div class="col">
      <a href="#"> Client</a>
      <a href="#">Commande</a>
      <a href="#">Livraison</a>
      <a href="#">Fournisseurs</a>
      <a href="#">Contact</a>
      <a href="#">Statistiques</a>
      <a href="#">Formulaires</a>

    </div>
  <div class="col-7 col">
    <div id="map"></div>



      <div>
        <h2>Livraison en cours</h2>
        <p>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Praesentium quam consectetur, veniam perferendis
          offici</p>
        <p>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Praesentium quam consectetur, veniam perferendis
          offici</p>
        <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#exampleModal">Contacter un
          livreur </button>
        <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#creerclient">Créer une
          livraison </button>
      </div>

  </div>




  <div class="col">
    3 of 3
  </div>
  </div>
</div>


    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
      aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <img src="../image/camion.png" alt="">
            <h5 class="modal-title" id="exampleModalLabel">Contacter un Livreur</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <form id="contact" method="post">
            <div class="modal-body">
              <p>Adresse :</p>
              <textarea name="" id="" cols="30" rows="10">
                        </textarea>
              <input type="radio" id="ordre" name="type" value="ordre">
              <label for="ordre">Ordre</label>
              <input type="radio" id="mission" name="type" value="mission">
              <label for="mission">Mission</label>
              <input type="radio" id="message" name="type" value="message">
              <label for="message">Message</label>
              <input type="radio" id="stop" name="type" value="stop">
              <label for="stop">Stop</label>
              <br>
              <label for="livreur">Livreur :</label>
              <select name="livreur" id="">
                <option value="1">Livreur 1</option>
                <option value="2">Livreur 2</option>
                <option value="3">Livreur 3</option>
                <option value="4">Livreur 4</option>
                <option value="5">Livreur 5</option>

              </select>
              <label>Adresse de Livraison</label>
              <input type="text">

            </div>
            <div class="modal-footer">
              <button id="submit" type="button">Envoyer</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="modal fade" id="creerclient" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
      aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <img src="../image/camion.png" alt="">
            <h5 class="modal-title" id="exampleModalLabel">Creer une livraison</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <form id="contact" method="post">
            <div class="modal-body">
              <p>Adresse :</p>
              <textarea name="" id="" cols="30" rows="10">
                        </textarea>
              <p>Type de livraison :</p>
              <input type="radio" id="ordre" name="type" value="ordre">
              <label for="ordre">Ordre</label>
              <input type="radio" id="mission" name="type" value="mission">
              <label for="mission">Mission</label>
              <br>
              <label for="livreur">Livreur :</label>
              <select name="livreur" id="">
                <option value="1">Livreur 1</option>
                <option value="2">Livreur 2</option>
                <option value="3">Livreur 3</option>
                <option value="4">Livreur 4</option>
                <option value="5">Livreur 5</option>

              </select>


            </div>
            <div class="modal-footer">
              <button id="submit" type="button">Ajouter</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div id="mySidenav" class="sidenav">
      <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
      <div class="message">

      </div>
      <script type="text/javascript">

          $('#pause').click(function(){
            jQuery('message').append("<p class='message'>Vous devez faire une pause !</p>");
            console.log("test");
          });
      </script>
      <div class="menu">


            <button  id="pause" type="button" class="btn btn-secondary menubtn">Pause</button>
            <button type="button" class="btn btn-secondary menubtn">Rappel</button>
            <button type="button" class="btn btn-secondary menubtn">alerte</button>
            <button type="button" class="btn btn-secondary menubtn">Envoyer</button>
            <br>
      <input type="text" name="" value="message">
      <button type="button" class="btn btn-primary">Envoyer</button>
    </div>




    </div>
  </div>



  <script>
    function openNav() {
      document.getElementById("mySidenav").style.display = "block";
    }

    function closeNav() {
      document.getElementById("mySidenav").style.display = "none";
    }
  </script>
  <script>
    $('#submit').click(function () {
      var form = $('#contact');
      var formData = form.serialize();
      $.ajax({
        type: "POST",
        url: 'http://vps.e-mingo.net/coopagri/app/index.php?c=message&a=getMessage',
        data: formData,
        success: function (data) {
          console.log("iok");
        },
        error: function (data) {
          console.log("false");
        }

      });
    });




  </script>
  <script>

  async function initMap() {
    let idCommandesDuJour = await getIdCommandesDuJour(); //On récupère les id des commandes du jour
    let adresseLivraison =  await getAdresseLivraisonId(idCommandesDuJour[2]);  //On récupère l'adresse de livraison de la commande numéro 3
    let adressesFournisseur = await getAdressesFournisseurId(idCommandesDuJour[2]); //On récupère les adresses des fournisseurs de la commande numéro 3
    let heureLivraison = await getHeureLivraison(idCommandesDuJour[2]);
    let maPosition = "Campus Maurois, 12 Allée André Maurois, 87065 Limoges"; //On définit le point de départ comme étant l'IUT
    console.log("Ma position :");
    console.log(maPosition);
    console.log("Adresse de livraison :");
    console.log(adresseLivraison);
    console.log("Adresse du/des fournisseurs :");
    console.log(adressesFournisseur);
    let tableauAdresses = [];
    for (var i = 0; i < adressesFournisseur.length; i++) {
      tableauAdresses[i] = adressesFournisseur[i];
    }
    tableauAdresses[adressesFournisseur.length] = adresseLivraison; //On crée un tableau d'adresse qui contient tous les fournisseurs et en dernier l'adresse de livraison
    console.log("Tous les waypoints de l'itinéraire :");
    console.log(tableauAdresses);
    console.log("Date et heure de livraison :");
    console.log(heureLivraison);

    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 12,
    });


    directionsService = new google.maps.DirectionsService,
    directionsDisplay = new google.maps.DirectionsRenderer({
      map: map,
      polylineOptions: {
        strokeColor: 'red',
        strokeOpacity: 1,
        icons: [{
          icon: {
            path: google.maps.SymbolPath.CIRCLE,
            scale: 5,
            strokeColor: '#EA4335',
            strokeOpacity: 0.8
          },
          offset: '100%'
        }]
      }
    });

    var waypts = Array();
    for (var i = 0; i < tableauAdresses.length; i++) {
      waypts.push({
        location: tableauAdresses[i],
        stopover: true
      });
    }
    geocoder = new google.maps.Geocoder();

    var route = adresse2LongLatt(geocoder, map, maPosition, waypts);
  }


  function adresse2LongLatt(geocoder, map, maPosition, waypts) {
    geocoder.geocode({ 'address': maPosition }, function (results, status) {
      if (status === 'OK') {
        map.setCenter(results[0].geometry.location);
        var marker = new google.maps.Marker({
          //rajouter l'icone qu'on recevra
          map: map,
          animation: google.maps.Animation.DROP,
          position: results[0].geometry.location,
          label: "Vous êtes ici"
        });
        var route = calculateAndDisplayRoute(directionsService, directionsDisplay, maPosition, waypts);
        return route;
      } else {
        alert('Geocode was not successful for the following reason: ' + status);
      }
    });
  }

  function calculateAndDisplayRoute(directionsService, directionsDisplay, maPosition, waypts) {
    directionsService.route({
        origin: maPosition,
        destination: maPosition,
        waypoints: waypts,
        optimizeWaypoints: true,
        travelMode: google.maps.TravelMode.DRIVING
      }, function (response, status) {
        if (status == google.maps.DirectionsStatus.OK) {
          directionsDisplay.setDirections(response);
          var route = directionsDisplay.getDirections().routes[0];
          var points = route.overview_path;
          return points;
        } else {
          window.alert('Directions request failed due to ' + status);
        }
      });
  }




  </script>
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyASkEyGK2Y2T7IJPozcR_g6S6Uo8AIOzic&callback=initMap">
  </script>
<style>
    #map {
      height: 100%;
    }

    /* Optional: Makes the sample page fill the window. */
    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
  }
</style>

  <div id="map"></div>


</body>

</html>
